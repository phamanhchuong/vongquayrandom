<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>V√≤ng quay may m·∫Øn</title>

<style>
*{box-sizing:border-box;font-family:Arial}
body{
    margin:0;
    min-height:100vh;
    background:linear-gradient(135deg,#7f7fd5,#86a8e7,#91eae4);
}

/* LOGIN */
#loginScreen{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.6);
    display:flex;
    justify-content:center;
    align-items:center;
    z-index:10;
}
.login-box{
    background:#fff;
    padding:25px;
    border-radius:18px;
    width:300px;
    text-align:center;
}
.login-box input{
    width:100%;
    padding:10px;
    margin:8px 0;
    border-radius:10px;
    border:1px solid #ccc;
}
.input-wrap{position:relative}
.eye{
    position:absolute;
    right:12px;
    top:50%;
    transform:translateY(-50%);
    cursor:pointer;
}
.login-box button{
    width:100%;
    padding:10px;
    border:none;
    border-radius:20px;
    background:#6c5ce7;
    color:#fff;
    font-weight:bold;
}

/* LAYOUT */
.main{
    display:flex;
    gap:20px;
    padding:20px;
}
.left{
    flex:1;
    background:rgba(255,255,255,.25);
    border-radius:24px;
    padding:20px;
    text-align:center;
    position:relative;
}
.right{
    width:440px;
    background:#fff;
    border-radius:24px;
    padding:20px;
}

/* LOGOUT */
.logout-btn{
    position:absolute;
    top:15px;
    right:15px;
    padding:6px 14px;
    border:none;
    border-radius:16px;
    background:#ff7675;
    color:#fff;
    cursor:pointer;
    display:none;
}

/* WHEEL */
.wheel-wrap{
    position:relative;
    width:320px;
    height:320px;
    margin:20px auto;
}
canvas{
    background:#fff;
    border-radius:50%;
}
.pointer{
    position:absolute;
    top:-18px;
    left:50%;
    transform:translateX(-50%);
    width:0;height:0;
    border-left:16px solid transparent;
    border-right:16px solid transparent;
    border-top:32px solid gold;
}
.spin-btn{
    margin-top:15px;
    padding:12px 40px;
    border:none;
    border-radius:30px;
    font-weight:bold;
    background:linear-gradient(135deg,#ffe259,#ffa751);
}

/* TABLE */
table{
    width:100%;
    border-collapse:collapse;
    margin-top:10px;
}
th,td{
    padding:8px;
    text-align:center;
    border-bottom:1px solid #eee;
}
th{background:#f3f4f6}

/* ACTIONS */
.actions{
    display:flex;
    gap:10px;
    margin-top:12px;
}
.actions button{
    flex:1;
    padding:8px;
    border:none;
    border-radius:20px;
    background:#6c5ce7;
    color:#fff;
}

/* POPUP */
.popup{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.6);
    display:flex;
    justify-content:center;
    align-items:center;
    opacity:0;
    pointer-events:none;
}
.popup.show{opacity:1;pointer-events:auto}
.popup-box{
    background:#fff;
    padding:22px;
    border-radius:18px;
    width:300px;
    text-align:center;
}
.btn-row{
    display:flex;
    gap:10px;
    margin-top:10px;
}
.btn-row button{
    flex:1;
    padding:8px;
    border:none;
    border-radius:20px;
    background:#6c5ce7;
    color:#fff;
}
h1{
    font-size: 45px;
}
</style>
</head>

<body>

<div id="loginScreen" tabindex="-1">
    <div class="login-box">
        <h3>ƒêƒÉng nh·∫≠p</h3>
        <input id="nameInput" placeholder="Nh·∫≠p t√™n">
        <div class="input-wrap">
            <input id="passInput" type="password" placeholder="M·∫≠t kh·∫©u">
            <span class="eye" onclick="togglePass()">üëÅÔ∏è</span>
        </div>
        <p id="loginErr" style="color:red"></p>
        <button onclick="login()">X√°c nh·∫≠n</button>
    </div>
</div>

<div class="main">
    <div class="left">
        <button class="logout-btn" id="logoutBtn" onclick="logout()">üîô ƒêƒÉng xu·∫•t</button>
        <h1>üé∞ V√íNG QUAY MAY M·∫ÆN</h1>
        <div class="wheel-wrap">
            <div class="pointer"></div>
            <canvas id="wheel" width="300" height="300"></canvas>
        </div>
        <button class="spin-btn" onclick="spin()">QUAY NGAY</button>
    </div>

    <div class="right">
        <h3>üìú L·ªäCH S·ª¨</h3>
        <table>
            <thead>
                <tr>
                    <th>#</th><th>T√™n</th><th>√î</th><th>Ti·ªÅn</th><th>Th·ªùi gian</th>
                </tr>
            </thead>
            <tbody id="historyBody"></tbody>
        </table>

        <div class="actions">
            <button onclick="adminGuard(openTotal)">üí∞ T·ªîNG</button>
            <button onclick="adminGuard(showTop)">üèÜ TOP</button>
            <button onclick="adminGuard(confirmClear)">üóëÔ∏è X√ìA</button>
        </div>
    </div>
</div>

<div class="popup" id="popup">
    <div class="popup-box" id="popupContent"></div>
</div>

<script>
const PASSWORD="1";
const ADMIN_NAME="admin";
const ADMIN_PASS="admin123";

const values=[1,2,3,4,5,6,7,8,9,10];
const base=300000;
const colors=["#ff7675","#74b9ff","#55efc4","#ffeaa7","#a29bfe","#fd79a8","#fab1a0","#81ecec","#6c5ce7","#00cec9"];

const canvas=document.getElementById("wheel");
const ctx=canvas.getContext("2d");
const c=canvas.width/2;
const historyBody=document.getElementById("historyBody");

let angle=0;
let spinning=false;
let player="";
let isAdmin=false;
let highlightIndex=null;

/* LOGIN */
function togglePass(){
    passInput.type = passInput.type==="password"?"text":"password";
}
function login(){
    const name=nameInput.value.trim();
    const pass=passInput.value;

    if(!name){loginErr.textContent="Nh·∫≠p t√™n";return;}

    if(name===ADMIN_NAME && pass===ADMIN_PASS){
        isAdmin=true;
    }else{
        if(pass!==PASSWORD){loginErr.textContent="Sai m·∫≠t kh·∫©u";return;}
        player=name;
        isAdmin=false;
    }

    logoutBtn.style.display="block";
    loginErr.textContent="";
    loginScreen.style.display="none";
}

/* LOGOUT ‚Äì FIX FOCUS TRI·ªÜT ƒê·ªÇ */
function logout(){
    player="";
    isAdmin=false;
    nameInput.value="";
    passInput.value="";
    loginErr.textContent="";
    logoutBtn.style.display="none";
    loginScreen.style.display="flex";
    loginScreen.focus();
}

/* ADMIN GUARD */
function adminGuard(fn){
    if(!isAdmin){
        showPopup("‚ùå Ch·ªâ admin m·ªõi s·ª≠ d·ª•ng ƒë∆∞·ª£c<div class='btn-row'><button onclick='closePopup()'>OK</button></div>");
        return;
    }
    fn();
}

/* DRAW */
function drawWheel(){
    const slice=2*Math.PI/values.length;
    ctx.clearRect(0,0,300,300);

    values.forEach((v,i)=>{
        const start=angle+i*slice-Math.PI/2;
        ctx.beginPath();
        ctx.moveTo(c,c);
        ctx.arc(c,c,c-5,start,start+slice);

        ctx.fillStyle=colors[i];
        ctx.fill();

        if(i===highlightIndex){
            ctx.save();
            ctx.shadowBlur=30;
            ctx.shadowColor="#fff700";
            ctx.fillStyle="rgba(255,255,200,0.9)";
            ctx.fill();
            ctx.restore();
        }

        ctx.save();
        ctx.translate(c,c);
        ctx.rotate(start+slice/2);
        ctx.font="bold 14px Arial";
        ctx.fillStyle="#333";
        ctx.fillText(v,c*0.6,5);
        ctx.restore();
    });
}

/* SPIN */
function spin(){
    if(spinning || !player || isAdmin) return;
    spinning=true;
    highlightIndex=null;

    const index=Math.floor(Math.random()*values.length);
    const slice=360/values.length;
    const stop=360-(index*slice+slice/2);
    const total=360*6+stop;

    const start=performance.now();
    const duration=2200;

    function ani(t){
        const p=Math.min((t-start)/duration,1);
        const ease=1-Math.pow(1-p,3);

        angle=total*ease*Math.PI/180;
        drawWheel();

        if(p<1) requestAnimationFrame(ani);
        else{
            highlightIndex=index;
            drawWheel();

            setTimeout(()=>{
                spinning=false;
                const money=values[index]*base;
                saveHistory(player,values[index],money);
                showPopup(`üéâ <b>Ch√∫c m·ª´ng</b> üéâ <br><br> <b>${player}</b> <br><br>üéØ <b>${player}</b> ƒë√£ quay tr√∫ng √¥ s·ªë :  <b>${values[index]}</b><br><br>üí∞ Ph·∫ßn th∆∞·ªüng <b>${player}</b> nh·∫≠n ƒë∆∞·ª£c :  <b>${money.toLocaleString()}ƒë üí∞</b>
                <div class='btn-row'><button onclick='nextPlayer()'>OK</button></div>`);
            },500);
        }
    }
    requestAnimationFrame(ani);
}

/* HISTORY */
function saveHistory(name,v,m){
    const h=JSON.parse(localStorage.getItem("history"))||[];
    h.unshift({player:name,v,m,time:new Date().toLocaleString("vi-VN")});
    localStorage.setItem("history",JSON.stringify(h));
    render();
}
function render(){
    const h=JSON.parse(localStorage.getItem("history"))||[];
    historyBody.innerHTML=h.map((i,idx)=>`
        <tr>
            <td>${idx+1}</td>
            <td>${i.player}</td>
            <td>${i.v}</td>
            <td>${i.m.toLocaleString()}ƒë</td>
            <td>${i.time}</td>
        </tr>`).join("");
}
render();

/* ADMIN */
function openTotal(){
    showPopup(`<h4>T·ªïng ti·ªÅn</h4><input id="tname"><div class='btn-row'><button onclick="calcTotal()">T√≠nh</button></div>`);
}
function calcTotal(){
    const n=tname.value;
    const h=JSON.parse(localStorage.getItem("history"))||[];
    const sum=h.filter(i=>i.player===n).reduce((s,i)=>s+i.m,0);
    showPopup(`üí∞ ${n}: <b>${sum.toLocaleString()}ƒë</b><div class='btn-row'><button onclick='closePopup()'>OK</button></div>`);
}
function showTop(){
    const h=JSON.parse(localStorage.getItem("history"))||[];
    const map={};
    h.forEach(i=>map[i.player]=(map[i.player]||0)+i.m);
    let top="",max=0;
    for(let k in map) if(map[k]>max){max=map[k];top=k;}
    showPopup(`üèÜ ${top}<br>üí∞ ${max.toLocaleString()}ƒë<div class='btn-row'><button onclick='closePopup()'>OK</button></div>`);
}
function confirmClear(){
    showPopup(`X√≥a l·ªãch s·ª≠?<div class='btn-row'><button onclick="clearHistory()">X√≥a</button><button onclick="closePopup()">H·ªßy</button></div>`);
}
function clearHistory(){
    localStorage.removeItem("history");
    render();
    closePopup();
}

/* POPUP */
function showPopup(html){
    popupContent.innerHTML=html;
    popup.classList.add("show");
}
function closePopup(){
    popup.classList.remove("show");
}
function nextPlayer(){
    closePopup();
    logout();
}

drawWheel();
</script>
</body>
</html>


